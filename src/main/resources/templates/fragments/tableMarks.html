<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity6">
<body>
<div th:fragment="tableMarks">
    <p>Las notas que actualmente figuran en el sistema son las siguientes:</p>
    <button type="button" id="updateButton" class="btn btn-primary">Actualizar</button>
    <script th:inline="javascript">
        /*<![CDATA[*/
        $("#updateButton").click(function () {
            let page = /*[[${param.page != null and !#lists.isEmpty(param.page) ? param.page[0] : null}]]*/ null;
            let urlUpdate = '/home/update';
            if (page != null) {
                urlUpdate += "?page=" + page;
            }
            $("#marksTableContent").load(urlUpdate);
        });
        /*]]>*/
    </script>

    <div th:fragment="marksTableContent" id="marksTableContent">
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                <tr>
                    <th scope="col">id</th>
                    <th scope="col">Descripción</th>
                    <th scope="col">Puntuación</th>
                    <th scope="col"></th>
                    <th scope="col"></th>
                    <th scope="col"></th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="mark : ${marksList}">
                    <td scope="row" th:text="${mark.id}">1</td>
                    <td th:text="${mark.description}">Ejercicio 1</td>
                    <td th:text="${mark.score}">10</td>
                    <td><a th:href="${'/mark/details/' + mark.id}">detalles</a></td>
                    <td>
                        <a sec:authorize="hasRole('ROLE_PROFESSOR')"
                           th:href="${'/mark/edit/' + mark.id}">modificar</a>
                        <div sec:authorize="hasRole('ROLE_STUDENT')">
                            <div th:if="${mark.resend}">
                                <button type="button" th:id="${'resendButton' + mark.id}" class="btn btn-success">Reenviar</button>
                                <script th:inline="javascript">
                                    /*<![CDATA[*/
                                    $("#resendButton" + "[[${mark.id}]]").click(function () {
                                        $.get("/mark/[[${mark.id}]]/noresend", function () {
                                            let page = /*[[${param.page != null and !#lists.isEmpty(param.page) ? param.page[0] : null}]]*/ null;
                                            let urlUpdate = '/home/update';
                                            if (page != null) {
                                                urlUpdate += "?page=" + page;
                                            }
                                            $("#marksTableContent").load(urlUpdate);
                                        });
                                    });
                                    /*]]>*/
                                </script>
                            </div>
                            <div th:unless="${mark.resend}">
                                <button type="button" th:id="${'noresendButton' + mark.id}" class="btn btn-info">No reenviar</button>
                                <script th:inline="javascript">
                                    /*<![CDATA[*/
                                    $("#noresendButton" + "[[${mark.id}]]").click(function () {
                                        $.get("/mark/[[${mark.id}]]/resend", function () {
                                            let page = /*[[${param.page != null and !#lists.isEmpty(param.page) ? param.page[0] : null}]]*/ null;
                                            let urlUpdate = '/home/update';
                                            if (page != null) {
                                                urlUpdate += "?page=" + page;
                                            }
                                            $("#marksTableContent").load(urlUpdate);
                                        });
                                    });
                                    /*]]>*/
                                </script>
                            </div>
                        </div>
                    </td>
                    <td>
                        <a sec:authorize="hasRole('ROLE_PROFESSOR')"
                           th:href="${'/mark/delete/' + mark.id}">eliminar</a>
                    </td>
                </tr>
                </tbody>
            </table>
            <div th:if="${#lists.isEmpty(marksList)}">No marks</div>
        </div>
    </div>
    <footer th:replace="~{fragments/pagination}"></footer>
</div>
</body>
</html>